# AWS S3

* [minio](https://docs.minio.io/) - O/S S3 clone
* <https://github.com/rufuspollock/s3-bucket-listing> - Create nice directory listings for s3 buckets with javascript
  and HTML.
* [Boto3 S3 Client API](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html)
* [Bucket Naming Rules](https://docs.aws.amazon.com/AmazonS3/latest/userguide/bucketnamingrules.html)
* [How Amazon Simple Storage Service (Amazon S3) uses AWS KMS](https://docs.aws.amazon.com/kms/latest/developerguide/services-s3.html)
* [Using server-side encryption with AWS KMS keys (SSE-KMS)](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html)
  * [Configuring your bucket to use an S3 Bucket Key with SSE-KMS for new objects](https://docs.aws.amazon.com/AmazonS3/latest/userguide/configuring-bucket-key.html)

## Tools

* [s5cmd](https://github.com/peak/s5cmd) - fast (parallel) S3 CLI tool.

## CLI

Need the following environment variables: `AWS_REGION`, `AWS_ACCESS_KEY_ID`, `AWS_SECRET_ACCESS_KEY`

```shell script
aws s3 mv --recursive s3://source/ s3://target/

# Sync is much faster than copying individual files, and is automatically recursive
aws s3 sync --delete --only-show-errors <source> <target>
```

# Can't use wildcards with aws s3 ls, so have to pattern match! ([ref](https://github.com/aws/aws-cli/issues/3784#issuecomment-517063693))

```shell script
for file in $(aws s3 ls "s3://path" | tr -s ' '| cut -d ' ' -f3); do
  if [[ ${file} =~ ^3.${release}\. ]]; then
```

# Security

* The meaning of "public": ([ref](https://docs.aws.amazon.com/AmazonS3/latest/userguide/access-control-block-public-access.html#access-control-block-public-access-policy-status)):

  > ACLs
  >
  > Amazon S3 considers a bucket or object ACL public if it grants any permissions to members of the predefined AllUsers or AuthenticatedUsers groups. For more information about predefined groups, see Amazon S3 predefined groups.
  >
  > Policies
  >
  > When evaluating a bucket policy, Amazon S3 begins by assuming that the policy is public. It then evaluates the policy to determine whether it qualifies as non-public. To be considered non-public, a bucket policy must grant access only to fixed values (values that don't contain a wildcard) of one or more of the following: sorce IP, AWS id, ARN, VPC, ...

* [Why do cross-account users receive Access Denied errors when they try to access my S3 objects that I encrypted with an AWS KMS customer managed key?](https://repost.aws/knowledge-center/cross-account-access-denied-error-s3)
  * Need to give permissions to both the S3 bucket *and* the KMS key.

# Libraries

* [s3fs](https://github.com/fsspec/s3fs) - builds on aiobotocore to provide a convenient Python filesystem interface for S3.